# 开发计划 & 差异对比

## 开发分期

### Phase 1: 🗺️ 地图骨架 + 基础移动 ✅
### Phase 2: 🤖 NPC 系统 + AI 驱动 ✅
### Phase 3: 💬 对话系统 + 社交 ✅
### Phase 4: 📊 属性系统 ✅
### Phase 5: 🎨 美化 + 细节 🔧 进行中
### Phase 6: 🧠 精神系统 + NPC 感知增强 ✅

---

## 已完成功能 Checklist（更新至 v1.2）

### 基础系统 ✅
- [x] 8 个 NPC + 固定日程 + 天气动态调整
- [x] AI 决策 + 轮询加速
- [x] 七大属性系统（六大+San值）+ 生病机制
- [x] NPC↔NPC 对话 + 玩家对话
- [x] 详情面板（属性/日程/记录/关系）
- [x] 天气系统 + 昼夜光照
- [x] Sprite 动画 + 高DPI适配
- [x] 饥饿系统 + 餐饮日程 + 吃饭扣钱
- [x] 进出门自然过渡 + 防堵门
- [x] 角色性别/年龄/情感关系重构 + 差异化好感度

### San值 & 精神系统 ✅（v1.1）
- [x] 凌玥文艺演出机制（14:00广场 / 19:00酒馆，少量花钱恢复San值）
- [x] 苏医生心理咨询机制（医院，大量花钱快速恢复San值）
- [x] 发疯机制（San<15触发，随机乱走/说胡话/属性大幅下降）
- [x] 发疯连锁影响（魅力/情商下降 + 目击者好感度恶化）
- [x] 三大San值恢复途径（睡觉/演出/咨询）形成经济闭环

### NPC 感知增强 ✅（v1.2）
- [x] 同场景远距离NPC感知（64格范围 + 同区域概览）
- [x] NPC可主动走向远处的人聊天（wantChat远程寻路）
- [x] AI提示词强调附近人员信息（防止AI忽略）
- [x] 修复 _getNearbyNPCs 对象展开问题
- [x] 修复 findPath 返回 null 导致的崩溃

### 待完成 🔧
- [ ] 更多装饰物
- [ ] 音效
- [ ] 存档完善
- [ ] NPC 情感事件系统（表白/吵架/和好等剧情触发）

---

## 与原项目 town 的差异对比

| 维度 | town (Generative Agents) | gospeltown (福音小镇) |
|------|--------------------------|-------------------|
| **运行方式** | Python 后端 + Flask 服务 | 纯前端，双击 HTML |
| **前端引擎** | Phaser.js（Canvas 2D） | 原生 Canvas API |
| **交互模式** | 回放（非实时） | 实时交互 |
| **地图制作** | Tiled 编辑器 | 代码程序化生成 |
| **Agent 数量** | 25 个 | 10 个 |
| **AI 模型** | GLM-4-Flash + Embedding | 仅 GLM-4-Flash |
| **记忆系统** | 向量索引 + 三因子检索 | 简化版（最近 N 条） |
| **日程系统** | LLM 动态生成 24h 日程 | 预定义日程 + 天气动态调整 |
| **属性系统** | 无 | 七大属性（体力/San值/存款/魅力/智慧/健康/情商） |
| **精神系统** | 无 | San值 + 发疯机制 + 演出/咨询恢复经济闭环 |
| **NPC感知** | 向量检索 + 空间树 | 同场景全局感知 + 距离分层（近/远） |

---

## 附录 A: 快速开始

```bash
# 直接双击 index.html 即可运行！
open index.html
```