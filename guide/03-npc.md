# NPC 居民设计（v2.0 末日极寒生存版）

## 核心居民（8 人）

| 角色 | 性别 | 年龄 | 职业 | 住所 | 性格 | 家庭关系 |
|------|------|------|------|------|------|---------|
| **李婶** | ♀ | 42 | 物资总管/炊事长 | 宿舍B | 热心精明、照顾所有人 | 陆辰的妈妈 |
| **赵铁柱** | ♂ | 38 | 伐木工/锅炉工 | 宿舍A | 沉默寡言但行动力极强 | — |
| **王策** | ♂ | 32 | 技师/规划师 | 宿舍A | 理性冷静、逻辑至上 | — |
| **老钱** | ♂ | 60 | 镇长/精神领袖 | 宿舍B | 慈祥睿智、德高望重 | 清璇的爷爷 |
| **苏岩** | ♂ | 35 | 医官 | 宿舍A | 冷静专业、内心柔软 | — |
| **陆辰** | ♂ | 18 | 采集工/建筑工 | 宿舍A | 冲动但勇敢 | 李婶的儿子 |
| **凌玥** | ♀ | 22 | 侦察员/急救兵 | 宿舍B | 乐观坚韧、胆大心细 | — |
| **清璇** | ♀ | 16 | 药剂师学徒/陷阱工 | 宿舍B | 聪明好学、心灵手巧 | 老钱的孙女 |

---

## 家庭关系

- **李婶 → 陆辰（母子）**：李婶丧夫多年独自带大陆辰，末日来临后成为据点后勤管家，精打细算每一份物资。陆辰是据点最年轻的劳动力，李婶既为他骄傲又时刻担心安全。李婶设有 `protectTarget: 'lu_chen'`。
- **老钱 → 清璇（祖孙）**：老钱的哲学底蕴影响了清璇的文学气质。清璇聪明好学负责制药和无线电修理，老钱时刻挂念孙女。老钱设有 `protectTarget: 'qing_xuan'`，清璇设有 `protectTarget: 'old_qian'`。

---

## 💕 情感关系网

### 中年暖心线：赵铁柱（♂38）→ 李婶（♀42）
- 赵铁柱暗恋李婶已久，末日后更想保护她
- 李婶丧夫多年有好感但犹豫
- 陆辰对"准继父"态度：先排斥后接受

### 三角关系核心大戏：苏岩（♂35）vs 王策（♂32）→ 凌玥（♀22）
- 苏岩：成熟稳重，用医者身份默默关心凌玥
- 王策：理性知性，和凌玥同在前线（废墟/工坊），共患难
- 凌玥被两人同时追求，末日中的情感戏剧冲突

### 青春暗恋线：陆辰（♂18）↔ 清璇（♀16）
- 陆辰暗恋老钱的孙女清璇
- 清璇对陆辰有好感，但性格文静害羞
- 老钱和李婶作为长辈暗中观察

### 吃瓜搅局王：老钱（♂60）
- 看穿所有人感情，时不时"无意"点拨
- 最操心孙女清璇的感情

---

## 8 人生存贡献闭环

| 角色 | 角色定位(role) | 主要贡献 | 核心行动效果 |
|------|--------------|---------|-------------|
| **李婶** | support（后勤） | 物资管理 + 烹饪 | `reduce_waste`（浪费-20%）|
| **赵铁柱** | worker（工人） | 砍柴 + 暖炉维护 | `produce_resource(woodFuel, 10/h×1.5)` + `furnace_maintain` |
| **王策** | engineer（工程师） | 发电机维修 + 暖炉扩建 | `produce_resource(power, 8/h×2.0)` + `build_progress` |
| **老钱** | support（后勤） | 安抚民心 + 调解冲突 | `morale_boost(×2.0)` |
| **苏岩** | engineer（工程师） | 医疗坐诊 + 采集食物 + 巡查安抚 | `medical_heal(×2.0)` + `produce_resource(food, 8/h)` + `morale_boost` |
| **陆辰** | worker（工人） | 建材/食物采集 + 建造 | `produce_resource(material, 5/h×1.5)` + `produce_resource(food, 8/h×1.3)` |
| **凌玥** | special（特殊） | 废墟侦察 + 士气鼓舞 | `produce_resource(material)` + `morale_boost(×1.3)` |
| **清璇** | special（特殊） | 制药 + 无线电修理 + 陷阱 | `craft_medkit(×1.5)` + `repair_radio` + `patrol_bonus` |

---

## 各角色详细专长 & 日程

### 1. 李婶（li_shen）— 物资总管/炊事长

**专长（specialties）：**
| 专长键名 | 效果 |
|----------|------|
| `food_processing` | 食物加工效率 ×2.0 |
| `inventory_waste` | 物资盘点减少浪费 -20% |
| `fair_distribution` | 分配公平（减少冲突） |

**日程表：**
| 时段 | 动作 | 目标位置 | 行为描述 | 效果 |
|------|------|---------|---------|------|
| 0-6 | STAY | 宿舍B床位 | 休息睡觉 | — |
| 6-7 | WALK_TO | 炊事房 | 起床去炊事房准备早餐 | — |
| 7-8 | STAY | 炊事房内 | 在炊事房做早餐给大家吃 | reduce_waste |
| 8-12 | STAY | 仓库内 | 在仓库盘点物资、整理库存 | reduce_waste |
| 12-13 | WALK_TO | 炊事房 | 回炊事房准备午餐食材 | — |
| 13-17 | STAY | 仓库内 | 下午继续管理物资分配 | reduce_waste |
| 17-19 | STAY | 炊事房内 | 准备晚餐、分配食物 | reduce_waste |
| 19-22 | STAY | 仓库内 | 夜间整理物资、记录消耗 | reduce_waste |
| 22-24 | STAY | 炊事房内 | 准备明日食材、打扫炊事房 | reduce_waste |

---

### 2. 赵铁柱（zhao_chef）— 伐木工/锅炉工

**专长（specialties）：**
| 专长键名 | 效果 |
|----------|------|
| `chopping` | 砍柴 ×1.5 |
| `hauling` | 搬运 ×1.5 |
| `furnace_maintain` | 暖炉维护 ×2.0 |

**日程表：**
| 时段 | 动作 | 目标位置 | 行为描述 | 效果 |
|------|------|---------|---------|------|
| 0-6 | STAY | 宿舍A床位 | 休息睡觉 | — |
| 6-7 | WALK_TO | 炊事房 | 起床去吃早餐 | — |
| 7-8 | WALK_TO | 暖炉广场 | 去暖炉广场检查暖炉状态 | furnace_maintain |
| 8-12 | WALK_TO | 伐木场 | 出北门去伐木场砍柴 | produce_resource(woodFuel, 10/h×1.5) |
| 12-13 | WALK_TO | 仓库 | 搬运木柴回仓库 | — |
| 13-17 | WALK_TO | 伐木场 | 下午继续砍柴搬运 | produce_resource(woodFuel, 10/h×1.5) |
| 17-18 | WALK_TO | 仓库 | 把下午的木柴送回仓库 | — |
| 18-19 | WALK_TO | 炊事房 | 去炊事房吃晚饭 | — |
| 19-22 | STAY | 暖炉广场 | 维护暖炉、添加柴火 | furnace_maintain(×2.0) |
| 22-24 | STAY | 工坊内 | 夜间在工坊修理工具 | produce_resource(power, 4/h) |

---

### 3. 王策（wang_teacher）— 技师/规划师

**专长（specialties）：**
| 专长键名 | 效果 |
|----------|------|
| `generator_repair` | 发电机维修 ×2.0 |
| `furnace_build` | 暖炉扩建 ×1.5 |
| `team_planning` | 全队规划 +10%效率 |

**日程表：**
| 时段 | 动作 | 目标位置 | 行为描述 | 效果 |
|------|------|---------|---------|------|
| 0-6 | STAY | 宿舍A床位 | 休息睡觉 | — |
| 6-7 | WALK_TO | 炊事房 | 起床去吃早餐 | — |
| 7-8 | WALK_TO | 工坊 | 去工坊检查发电机 | produce_resource(power) |
| 8-12 | STAY | 工坊内 | 维修发电机、设计暖炉扩建方案 | produce_resource(power, 8/h×2.0) + build_progress |
| 12-13 | WALK_TO | 炊事房 | 去炊事房吃午饭 | — |
| 13-17 | STAY | 工坊内 | 下午继续技术工作、制造工具 | produce_resource(power, 8/h×2.0) |
| 17-18 | WALK_TO | 暖炉广场 | 去暖炉广场统筹全队进度 | morale_boost |
| 18-19 | WALK_TO | 炊事房 | 去炊事房吃晚饭 | — |
| 19-22 | STAY | 工坊内 | 夜间加班推进暖炉扩建设计 | build_progress(×1.5) |
| 22-24 | STAY | 工坊内 | 深夜整理图纸、规划明日任务 | build_progress |

---

### 4. 老钱（old_qian）— 镇长/精神领袖

**专长（specialties）：**
| 专长键名 | 效果 |
|----------|------|
| `conflict_resolve` | 调解冲突成功率 ×2.0 |
| `morale_boost` | 安抚效果 ×2.0 |
| `crisis_predict` | 经验判断（预警资源危机） |

**日程表：**
| 时段 | 动作 | 目标位置 | 行为描述 | 效果 |
|------|------|---------|---------|------|
| 0-6 | STAY | 宿舍B床位 | 休息睡觉 | — |
| 6-7 | WALK_TO | 炊事房 | 起床去吃早餐 | — |
| 7-8 | WALK_TO | 暖炉广场 | 去暖炉广场主持早会分配任务 | morale_boost |
| 8-12 | STAY | 暖炉广场 | 协调各组工作、巡视据点 | morale_boost(×2.0) |
| 12-13 | WALK_TO | 炊事房 | 去炊事房吃午饭 | — |
| 13-17 | STAY | 仓库内 | 下午在仓库协助李婶盘点、做决策 | reduce_waste |
| 17-18 | WALK_TO | 暖炉广场 | 傍晚在暖炉旁与大家谈心 | morale_boost(×2.0) |
| 18-19 | WALK_TO | 炊事房 | 去炊事房吃晚饭 | — |
| 19-22 | STAY | 暖炉广场 | 夜间在暖炉旁安抚民心、讲故事 | morale_boost(×2.0) |
| 22-24 | WALK_TO | 宿舍B | 回宿舍B准备休息 | — |

---

### 5. 苏岩（su_doctor）— 医官

**专长（specialties）：**
| 专长键名 | 效果 |
|----------|------|
| `medical_treatment` | 治疗冻伤效果 ×2.0 |
| `hypothermia_save` | 失温救治成功率 +50% |
| `therapy` | 心理疏导San恢复 ×1.5 |

**日程表（v2.1优化版 — 5h坐诊+4h采集+2h巡查安抚）：**
| 时段 | 动作 | 目标位置 | 行为描述 | 效果 |
|------|------|---------|---------|------|
| 0-6 | STAY | 宿舍A床位 | 休息睡觉 | — |
| 6-7 | WALK_TO | 炊事房 | 起床去吃早餐 | — |
| 7-8 | WALK_TO | 医疗站 | 去医疗站准备药品、检查设备 | craft_medkit |
| 8-10 | STAY | 医疗站内 | 在医疗站坐诊、治疗冻伤患者 | medical_heal(×2.0) |
| 10-12 | WALK_TO | 冰湖 | 去冰湖采集食物 | produce_resource(food, 8/h×1.0) |
| 12-13 | WALK_TO | 炊事房 | 去炊事房吃午饭 | — |
| 13-15 | WALK_TO | 冰湖 | 下午去冰湖采集食物 | produce_resource(food, 8/h×1.0) |
| 15-17 | STAY | 医疗站内 | 下午在医疗站坐诊、心理疏导 | medical_heal(×2.0) |
| 17-18 | WALK_TO | 暖炉广场 | 去暖炉旁巡查大家的健康状况 | medical_heal |
| 18-19 | WALK_TO | 炊事房 | 去炊事房吃晚饭 | — |
| 19-21 | STAY | 暖炉广场 | 在暖炉旁巡查大家的健康、安抚民心 | medical_heal + morale_boost |
| 21-22 | STAY | 医疗站内 | 夜间值班、处理突发伤病 | medical_heal(×2.0) |
| 22-24 | STAY | 医疗站内 | 深夜整理药品、写医疗记录 | craft_medkit |

> **v2.1日程优化说明**：苏岩从原来11小时医疗站坐诊（大部分空转）优化为5小时精准坐诊+4小时冰湖采集食物（+32食物/天）+2小时暖炉广场巡查安抚，显著提升实际贡献。

---

### 6. 陆辰（lu_chen）— 采集工/建筑工

**专长（specialties）：**
| 专长键名 | 效果 |
|----------|------|
| `gathering_material` | 建材采集 ×1.5 |
| `gathering_food` | 食物采集 ×1.3 |
| `construction` | 建造 ×1.3 |
| `cold_resist` | 耐寒：体温下降速度 ×0.7 |

**日程表：**
| 时段 | 动作 | 目标位置 | 行为描述 | 效果 |
|------|------|---------|---------|------|
| 0-6 | STAY | 宿舍A床位 | 休息睡觉 | — |
| 6-7 | WALK_TO | 炊事房 | 起床去吃早餐 | — |
| 7-8 | WALK_TO | 仓库 | 去仓库领取采集工具 | — |
| 8-12 | WALK_TO | 废墟 | 出北门去废墟采集建材 | produce_resource(material, 5/h×1.5) |
| 12-13 | WALK_TO | 仓库 | 搬运建材回仓库、吃午饭 | — |
| 13-17 | WALK_TO | 冰湖 | 下午去冰湖捕鱼获取食物 | produce_resource(food, 8/h×1.3) |
| 17-18 | WALK_TO | 仓库 | 把食物送回仓库 | — |
| 18-19 | WALK_TO | 炊事房 | 去炊事房吃晚饭 | — |
| 19-22 | STAY | 工坊内 | 夜间在工坊协助建造工作 | build_progress(×1.3) |
| 22-24 | STAY | 仓库内 | 深夜搬运整理物资 | reduce_waste |

---

### 7. 凌玥（ling_yue）— 侦察员/急救兵

**专长（specialties）：**
| 专长键名 | 效果 |
|----------|------|
| `scout_ruins` | 废墟侦察稀有物资概率 ×2.0 |
| `field_aid` | 野外急救效率 ×1.5 |
| `morale_inspire` | 鼓舞士气San恢复 ×1.3 |
| `climb_explore` | 可进入危险区域搜索 |

**日程表：**
| 时段 | 动作 | 目标位置 | 行为描述 | 效果 |
|------|------|---------|---------|------|
| 0-6 | STAY | 宿舍B床位 | 休息睡觉 | — |
| 6-7 | WALK_TO | 炊事房 | 起床去吃早餐 | — |
| 7-8 | WALK_TO | 暖炉广场 | 去暖炉广场和大家碰头 | morale_boost |
| 8-12 | WALK_TO | 废墟 | 出北门去废墟侦察搜索物资 | produce_resource(material) |
| 12-13 | WALK_TO | 仓库 | 搬运搜获物资回仓库 | — |
| 13-15 | WALK_TO | 医疗站 | 去医疗站协助苏岩处理伤患 | medical_heal(×1.5) |
| 15-17 | WALK_TO | 废墟 | 下午再次出发侦察废墟深处 | produce_resource(material) |
| 17-18 | WALK_TO | 仓库 | 搬运物资回仓库 | — |
| 18-19 | WALK_TO | 炊事房 | 去炊事房吃晚饭 | — |
| 19-22 | STAY | 暖炉广场 | 在暖炉旁鼓舞大家士气、唱歌 | morale_boost(×1.3) |
| 22-24 | STAY | 医疗站内 | 深夜协助医疗站处理伤员 | medical_heal(×1.5) |

---

### 8. 清璇（qing_xuan）— 药剂师学徒/陷阱工

**专长（specialties）：**
| 专长键名 | 效果 |
|----------|------|
| `herbal_craft` | 草药制剂产出 ×1.5 |
| `trap_alarm` | 陷阱/警报装置 |
| `radio_repair` | 无线电修理 |
| `learn_others` | 学习他人技能效率 ×0.7 |

**日程表：**
| 时段 | 动作 | 目标位置 | 行为描述 | 效果 |
|------|------|---------|---------|------|
| 0-6 | STAY | 宿舍B床位 | 休息睡觉 | — |
| 6-7 | WALK_TO | 炊事房 | 起床去吃早餐 | — |
| 7-8 | WALK_TO | 医疗站 | 去医疗站准备草药材料 | — |
| 8-12 | STAY | 医疗站内 | 在医疗站制作草药制剂和急救包 | craft_medkit(×1.5) |
| 12-13 | WALK_TO | 炊事房 | 去炊事房吃午饭 | — |
| 13-15 | WALK_TO | 南门 | 去南门外布置警报陷阱 | patrol_bonus |
| 15-17 | STAY | 工坊内 | 在工坊修理无线电台 | repair_radio |
| 17-18 | WALK_TO | 医疗站 | 回医疗站整理制好的药品 | craft_medkit |
| 18-19 | WALK_TO | 炊事房 | 去炊事房吃晚饭 | — |
| 19-22 | STAY | 工坊内 | 夜间继续修理无线电、制作陷阱 | repair_radio + patrol_bonus |
| 22-24 | STAY | 医疗站内 | 深夜在医疗站继续制药 | craft_medkit(×1.5) |

---

## 居民 AI 行为循环

```
每个居民的 think() 循环:
  ├── 1. 感知 (percept)
  │   ├── describe() → 当前位置文字描述
  │   ├── scanNearby() → 附近 64 格内的其他居民（+同场景远处NPC概览）
  │   └── getInterestPoints() → 当前场景的兴趣点
  │
  ├── 2. 日程匹配 (schedule)
  │   ├── 根据 gameTime 查找当前应做的活动
  │   └── 如果当前行动已完成 → 进入下一个日程
  │
  ├── 3. 行动效果匹配 (_updateActionEffect)
  │   ├── 遍历 ACTION_EFFECT_MAP，用关键词匹配当前 desc
  │   ├── 匹配成功 → 触发对应 effectType（produce_resource / medical_heal / ...）
  │   ├── _getSpecialtyMultiplier() → 根据角色 specialties 计算加成倍率
  │   ├── 体力效率惩罚：stamina < 30 时产出 ×0.5
  │   └── 更新动态气泡文本（显示实时数值，如"🪓 砍柴中（木柴+15/h）"）
  │
  ├── 4. 空转检测
  │   ├── 如果当前 desc 未匹配任何 ACTION_EFFECT_MAP 条目 → 标记为空转
  │   └── 空转行为不产生数值贡献（仅移动/吃饭/睡觉等属于正常非空转）
  │
  ├── 5. 社交检测 (social)
  │   ├── 附近是否有其他居民？（64格范围 + 同场景远处NPC）
  │   ├── 冷却时间检查（同人 30 分钟内不重复对话）
  │   └── LLM 决定是否发起对话（CHAT_ENABLED 开关控制）
  │
  ├── 6. 行动决策 (decide)
  │   ├── 社交优先 → 走向对方 + 发起对话
  │   ├── 日程驱动 → 走向目标地点
  │   └── 空闲时 → 随机闲逛/回家
  │
  └── 7. 执行 (execute)
      ├── findPath() → A* 寻路
      ├── 移动动画
      └── 到达后触发交互/对话
```

---

## 行动效果映射表（ACTION_EFFECT_MAP）

系统通过关键词匹配 NPC 当前行为描述（desc），自动触发对应效果：

| 效果类型 | 匹配关键词 | 场景要求 | 数值 | 气泡图标 |
|----------|-----------|---------|------|---------|
| produce_resource(woodFuel) | 砍柴、伐木、搬运木柴 | village | 10/h | 🪓 |
| produce_resource(food) | 采集食物、捕鱼、搜索罐头 | village | 8/h | 🎣 |
| produce_resource(material) | 采集建材、收集建材、废墟 | village | 5/h | 🧱 |
| produce_resource(power) | 维修发电机、检查发电机、技术工作、制造工具 | workshop | 8/h | 🔧 |
| build_progress | 暖炉扩建、设计暖炉、协助建造、整理图纸、规划 | workshop | 1/h | 🔨 |
| craft_medkit | 制作草药、急救包、草药制剂、制药、整理药品 | medical | 0.5/h | 💊 |
| repair_radio | 修理无线电、无线电台 | workshop | 1/h | 📻 |
| reduce_waste | 盘点物资、整理库存、管理物资、物资分配、搬运、整理物资 | warehouse | -20%浪费 | 📦 |
| reduce_waste | 做早餐、准备早餐/午餐/晚餐、分配食物、准备明日食材 | kitchen | -20%浪费 | 🍳 |
| medical_heal | 坐诊、治疗冻伤、心理疏导、巡查伤员、医疗救治、处理伤员 | medical | — | 🏥 |
| medical_heal | 巡查 | 不限 | — | 🏥 |
| furnace_maintain | 维护暖炉、添加柴火 | 不限 | — | 🔥 |
| patrol_bonus | 巡逻、警戒、安全巡查、巡视、陷阱、警报 | village | San恢复 | 🛡️ |
| morale_boost | 安抚、调解冲突、统筹、鼓舞、讲故事、安慰、谈心 | 不限 | San恢复 | 💬 |
| produce_resource(power) | 修理工具 | workshop | 4/h | 🔧 |
